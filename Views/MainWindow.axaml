<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:StormEdit.ViewModels"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d" d:DesignWidth="1000" d:DesignHeight="650"
        x:Class="StormEdit.Views.MainWindow"
        x:Name="root"
        x:DataType="vm:MainWindowViewModel"
        xmlns:local="using:StormEdit"
        Icon="/Assets/avalonia-logo.ico"
        Title="StormEdit"
        xmlns:ae="clr-namespace:AvaloniaEdit;assembly=Avalonia.AvaloniaEdit"
        xmlns:avaloniaedit="https://github.com/avaloniaui/avaloniaedit">

<Window.Styles>
    <Style Selector="Slider:horizontal /template/ Thumb">
        <Setter Property="Width" Value="10" />
        <Setter Property="Height" Value="10" />
    </Style>

    <Style Selector="avaloniaedit|TextEditor.full">
        <Setter Property="Grid.ColumnSpan" Value="3"/>
    </Style>
</Window.Styles>

    
    <Grid>
        <DockPanel>
            <Border DockPanel.Dock="Top" Background="#2d2d2d" Padding="10,5" BorderBrush="#3e3e3e" BorderThickness="0,0,0,1">
                <StackPanel Orientation="Horizontal" Spacing="15">
                    <TextBlock Text="STORMEDIT" VerticalAlignment="Center" FontWeight="Bold" Foreground="#9cdcfe" Margin="0,0,-15,0"/>
                    <TextBlock Text="v1.0.0" VerticalAlignment="Bottom" FontSize="10" Foreground="#FFFFFF" Margin="0,0,1,0"/>
                    <Menu Background="Transparent">
                        <MenuItem Header="File" Foreground="White">
                            <MenuItem Header="Open File..."/>
                            <MenuItem Header="Save All"/>
                            <Separator/>
                            <MenuItem Header="Exit"/>
                        </MenuItem>
                        <MenuItem Header="Config" Foreground="White">
                            <MenuItem Header="Settings" Command="{Binding OpenSettingsCommand}"/>
                            <MenuItem Header="Themes"/>
                        </MenuItem>
                    </Menu>
                </StackPanel>
            </Border>

            <Border DockPanel.Dock="Bottom" Background="#007acc" Height="30">
                <Grid ColumnDefinitions="*, Auto">
                    <TextBlock Grid.Column="0" Text="Ready" Foreground="White" FontSize="12" VerticalAlignment="Center" Margin="10,0"/>
                    <TextBlock Grid.Column="1" Text="{Binding EditorScriptLength, StringFormat='{}Script Length: {0}/4096'}"   Foreground="White" FontSize="12" VerticalAlignment="Center" Margin="0,0,10,0"/>
                </Grid>
            </Border>

            <Grid ColumnDefinitions="250, 4, *">
                
                <Border Grid.Column="0" Background="#252526" BorderBrush="#3e3e3e" BorderThickness="0,0,1,0">
                    <DockPanel>
                        <StackPanel Orientation="Horizontal" DockPanel.Dock="Top" Background="Transparent" Height="30">
                        
                        <TextBlock Text="EXPLORER" Foreground="#bbbbbb" FontSize="11" FontWeight="Bold" Margin="10,10,0,5"/>
                        <Button Content="Refresh" 
                                Command="{Binding RefreshExplorerCommand}"
                                Background="#3e3e3e" Foreground="White" FontSize="12"
                                Margin="5,3,5,0" Padding="6,0"
                                VerticalAlignment="Stretch" VerticalContentAlignment="Center"
                                HorizontalAlignment="Right"
                                BorderThickness="0"/>
                            </StackPanel>
                        <TreeView ItemsSource="{Binding ExplorerEntries}" 
          Background="Transparent" 
          BorderThickness="0">
    <TreeView.DataTemplates>
        
        <TreeDataTemplate DataType="{x:Type local:Creation}" 
                          ItemsSource="{Binding Scripts}">
            <StackPanel Orientation="Horizontal" Spacing="5">
                <TextBlock Text="{Binding Name}" VerticalAlignment="Center" Foreground="#eeeeee"/>
            </StackPanel>
        </TreeDataTemplate>

        <DataTemplate DataType="{x:Type local:LuaScript}">
            <StackPanel Orientation="Horizontal" Spacing="5">
                <TextBlock Text="{Binding Name}" VerticalAlignment="Center" Foreground="#9cdcfe"/>
            </StackPanel>
        </DataTemplate>

    </TreeView.DataTemplates>
</TreeView>
                    </DockPanel>
                </Border>

                <GridSplitter Grid.Column="1" Width="4" Background="#1e1e1e" ResizeDirection="Columns"/>

                <Grid Grid.Column="2" RowDefinitions="Auto,*">

    <StackPanel Grid.Row="0" Orientation="Horizontal" Background="#2d2d2d" Height="30">
        <TextBlock Text="{Binding FontSize, StringFormat='{}Size: {0}'}" 
                   VerticalAlignment="Center" Foreground="White" Margin="10,0,0,0"/>
        
        <Slider Minimum="12" Maximum="96" TickFrequency="2" Width="200" 
                Margin="10,-10,10,0" IsSnapToTickEnabled="True" 
                VerticalAlignment="Center" Value="{Binding FontSize}"/>

        <Button Content="Minify" 
                Command="{Binding MinifyCommand}"
                Background="#3e3e3e" Foreground="White" FontSize="12"
                Margin="10,3" Padding="10,0"
                VerticalAlignment="Stretch" VerticalContentAlignment="Center"
                BorderThickness="0"/>
    </StackPanel>

    <Grid Grid.Row="1" ColumnDefinitions="*, 4, *">
        
        <avaloniaedit:TextEditor Grid.Column="0"
                                 Document="{Binding Script}"
                                 Name="Editor"
                                 Classes.full="{Binding !IsMinifyOpen}"
                                 Background="#1e1e1e"
                                 Foreground="#d4d4d4"
                                 HorizontalScrollBarVisibility="Auto"
                                 VerticalScrollBarVisibility="Visible"
                                 WordWrap="True"
                                 ShowLineNumbers="True"
                                 FontFamily="Cascadia Code,Consolas,Monospace"
                                 FontSize="{Binding FontSize}"/>

        <GridSplitter Grid.Column="1" 
                      Width="4" 
                      Background="#2d2d2d" 
                      ResizeDirection="Columns"
                      IsVisible="{Binding IsMinifyOpen}"/>

        <Grid Grid.Column="2" 
              RowDefinitions="30, *"
              IsVisible="{Binding IsMinifyOpen}">
            
            <Border Grid.Row="0" Background="#252526" BorderBrush="#3e3e3e" BorderThickness="0,0,0,1">
                <Grid ColumnDefinitions="*, Auto, Auto">
                    <TextBlock Text="Minified Preview" Foreground="#cccccc" 
                               VerticalAlignment="Center" Margin="10,0" 
                               FontSize="12" FontStyle="Italic"/>
                    <TextBlock Text="{Binding MinifiedScriptLength, StringFormat='{}Minified Length: {0}/4096'}"
                               Grid.Column="1"
                               FontSize="12"
                               VerticalAlignment="Center" Padding="10,0"/>
                    <Button Grid.Column="2" 
                            Content="✕" 
                            Command="{Binding CloseMinifyCommand}"
                            Background="Transparent" Foreground="#cccccc"
                            BorderThickness="0" Padding="10,0"
                            VerticalAlignment="Stretch"/>
                </Grid>
            </Border>

            <avaloniaedit:TextEditor Grid.Row="1"
                                     Document="{Binding MinifiedScript}"
                                     Name="MinifiedPreview"
                                     IsReadOnly="True"
                                     Background="#1e1e1e"
                                     Foreground="#a0a0a0"
                                     HorizontalScrollBarVisibility="Auto"
                                     VerticalScrollBarVisibility="Visible"
                                     ShowLineNumbers="True"
                                     WordWrap="True"
                                     FontFamily="Cascadia Code,Consolas,Monospace"
                                     FontSize="{Binding FontSize}"/>
        </Grid>

    </Grid>

</Grid>
            </Grid>
        </DockPanel>

        <Border Background="#80000000" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" IsVisible="{Binding IsSettingsOpen}">
            <Grid ColumnDefinitions="2*, 6*, 2*">
                <Border Grid.Column="1" Background="#2d2d2d" CornerRadius="5" HorizontalAlignment="Stretch" VerticalAlignment="Center">
                    <StackPanel Spacing="2">
                        <TextBlock Text="Settings" Foreground="White" HorizontalAlignment="Center" Margin="20" FontWeight="SemiBold" FontSize="32"/>
                        <Grid ColumnDefinitions="Auto, *, Auto">
                            <TextBlock Grid.Column="0" Text="Stormworks Saves Path:" Margin ="15,0" Foreground="White" VerticalAlignment="Center"/>
                            <TextBox Grid.Column="1" Watermark="Enter Path" Margin="15, 0" Text ="{Binding GamePath}" HorizontalAlignment="Stretch" />
                            <Button Grid.Column="2" Content="Browse" Margin="0, 0, 15, 0" Command="{Binding OpenGameFolderCommand}" CommandParameter ="{Binding ElementName=root}" HorizontalAlignment="Right"/>
                        </Grid>
                        <Grid ColumnDefinitions="Auto, Auto">
							<TextBlock Grid.Column="0" Text = "Include Scriptless Creations In Explorer:" Margin="15,0" VerticalAlignment ="Center" />
                            <CheckBox Grid.Column="1" IsChecked="{Binding IncludeScriptlessCreations}" Margin="10,0"/>
                        </Grid>
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                            <Button Content="Save And Exit" HorizontalAlignment="Right" Margin="15, 15" Command="{Binding CloseSettingsCommand}"/>
                        </StackPanel>
                    </StackPanel>
                </Border>
            </Grid>
        </Border>
        <Border Background="#80000000" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" IsVisible="{Binding IsDialogueOpen}">
            <Grid ColumnDefinitions="2*, 3*, 2*">
                <Border Grid.Column="1" Background="#2d2d2d" CornerRadius="5" HorizontalAlignment="Stretch" VerticalAlignment="Center">
                    <StackPanel Spacing="2">
                        <TextBlock Text="{Binding DialogueTitle}" Foreground="White" HorizontalAlignment="Center" Margin="20" FontWeight="SemiBold" FontSize="32"/>
                        <TextBlock Text="{Binding DialogueMessage}" Foreground="White" HorizontalAlignment="Center" Margin="20" FontSize="16" TextWrapping="Wrap"/>
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                            <Button Content="OK" HorizontalAlignment="Right" Margin="15, 15" Command="{Binding CloseDialogueCommand}"/>
                        </StackPanel>
                    </StackPanel>
                </Border>
            </Grid>
        </Border>
    </Grid>
    

    

</Window>
